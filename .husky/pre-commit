set -e

LABELS_DIR="convex/location_labels"
GENERATED_FILE="convex/location_labels_generated.json"

has_label_changes() {
  git diff --name-only "$1" -- "$LABELS_DIR" | \
    grep -E '\.json$' | \
    grep -v "$(basename "$GENERATED_FILE")" >/dev/null 2>&1
}

if has_label_changes --cached || has_label_changes; then
  echo "Regenerating location label areas..."
  node scripts/gen-location-labels.mjs
  git add "$GENERATED_FILE"
fi
